{{ define "main" }}
<article class="article">
  {{/* Hero image: prefer cover, then thumbnail, else dynamic SVG; responsive srcset if assets exist */}}
  {{ $cover := .Params.cover }}
  {{ $media := cond (ne $cover "") $cover .Params.thumbnail }}
  {{ $isPlaceholder := or (eq $media "/images/og-default.svg") (eq $media "/images/sample-thumb.svg") }}
  {{ $needsDynamic := or (not $media) $isPlaceholder }}
  {{ if $needsDynamic }}
    {{ $key := md5 .Permalink }}
    {{ $tpl := resources.Get "images/project-thumb-template.svg" | resources.ExecuteAsTemplate (printf "gen/thumbs/%s.svg" $key) . }}
    <img class="cover" src="{{ $tpl.Permalink }}" alt="{{ .Title }} cover" loading="lazy" decoding="async" width="1200" height="675" sizes="(max-width: 1200px) 100vw, 1200px" />
  {{ else }}
    {{ $ext := path.Ext $media }}
    {{ $isSVG := eq (lower $ext) ".svg" }}
    {{ $assetsPath := printf "assets%s" $media }}
    {{ if and (not $isSVG) (fileExists $assetsPath) }}
      {{ $res := resources.Get (printf "%s" (replace $media "/" "/")) }}
      {{ if $res }}
        {{ $img800 := $res | images.Fit "800x450" }}
        {{ $img1200 := $res | images.Fit "1200x675" }}
        {{ $img1600 := $res | images.Fit "1600x900" }}
        <img class="cover"
             src="{{ $img1200.RelPermalink }}"
             srcset="{{ $img800.RelPermalink }} 800w, {{ $img1200.RelPermalink }} 1200w, {{ $img1600.RelPermalink }} 1600w"
             sizes="(max-width: 1200px) 100vw, 1200px"
             width="1200" height="675"
             alt="{{ .Title }} cover"
             loading="lazy" decoding="async" />
      {{ else }}
        <img class="cover" src="{{ $media | relURL }}" alt="{{ .Title }} cover" loading="lazy" decoding="async" width="1200" height="675" sizes="(max-width: 1200px) 100vw, 1200px" />
      {{ end }}
    {{ else }}
      <img class="cover" src="{{ $media | relURL }}" alt="{{ .Title }} cover" loading="lazy" decoding="async" width="1200" height="675" sizes="(max-width: 1200px) 100vw, 1200px" />
    {{ end }}
  {{ end }}

  <h1>{{ .Title }}</h1>
  {{ with .Date }}<p class="meta">{{ .Format "2006-01-02" }}</p>{{ end }}
  {{ with .Params.tags }}
    <ul class="tags">
      {{ range . }}<li>{{ . }}</li>{{ end }}
    </ul>
  {{ end }}

  <div class="content">
    {{ .Content }}
  </div>

  <nav class="pagination" aria-label="이전/다음 글" style="margin-top:32px; gap:16px; display:flex; justify-content:space-between; flex-wrap:wrap;">
    <div class="flex-1 min-w-0">
      {{ with .PrevInSection }}
        <a class="btn btn-ghost flex items-center gap-2" href="{{ .RelPermalink }}" aria-label="이전 글: {{ .Title }}">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
          <span class="truncate">{{ .Title }}</span>
        </a>
      {{ end }}
    </div>
    <div class="flex-1 min-w-0 text-right">
      {{ with .NextInSection }}
        <a class="btn btn-ghost flex items-center gap-2" href="{{ .RelPermalink }}" aria-label="다음 글: {{ .Title }}">
          <span class="truncate">{{ .Title }}</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
          </svg>
        </a>
      {{ end }}
    </div>
  </nav>
</article>
{{ end }}
