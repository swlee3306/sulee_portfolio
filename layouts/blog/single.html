{{ define "main" }}
<article class="article">
  {{/* Hero image: card-style 640x360 (same as list cards) */}}
  {{ $cover := .Params.cover }}
  {{ $media := cond (ne $cover "") $cover .Params.thumbnail }}
  {{ $isPlaceholder := or (eq $media "/images/og-default.svg") (eq $media "/images/sample-thumb.svg") }}
  {{ $needsDynamic := or (not $media) $isPlaceholder }}
  {{ if $needsDynamic }}
    {{ $key := md5 .Permalink }}
    {{ $tpl := resources.Get "images/project-thumb-template.svg" | resources.ExecuteAsTemplate (printf "gen/thumbs/%s.svg" $key) . }}
    <img class="thumb" src="{{ $tpl.Permalink }}" alt="{{ .Title }} cover" loading="lazy" decoding="async" width="640" height="360" sizes="(max-width: 700px) 100vw, 640px" />
  {{ else }}
    {{ $ext := path.Ext $media }}
    {{ $isSVG := eq (lower $ext) ".svg" }}
    {{ $assetsPath := printf "assets%s" $media }}
    {{ if and (not $isSVG) (fileExists $assetsPath) }}
      {{ $res := resources.Get (printf "%s" (replace $media "/" "/")) }}
      {{ if $res }}
        {{ $img640 := $res | images.Fit "640x360" }}
        {{ $img960 := $res | images.Fit "960x540" }}
        {{ $img1200 := $res | images.Fit "1200x675" }}
        <img class="thumb"
             src="{{ $img640.RelPermalink }}"
             srcset="{{ $img640.RelPermalink }} 640w, {{ $img960.RelPermalink }} 960w, {{ $img1200.RelPermalink }} 1200w"
             sizes="(max-width: 700px) 100vw, 640px"
             width="640" height="360"
             alt="{{ .Title }} cover"
             loading="lazy" decoding="async" />
      {{ else }}
        <img class="thumb" src="{{ $media | relURL }}" alt="{{ .Title }} cover" loading="lazy" decoding="async" width="640" height="360" sizes="(max-width: 700px) 100vw, 640px" />
      {{ end }}
    {{ else }}
      <img class="thumb" src="{{ $media | relURL }}" alt="{{ .Title }} cover" loading="lazy" decoding="async" width="640" height="360" sizes="(max-width: 700px) 100vw, 640px" />
    {{ end }}
  {{ end }}

  <h1>{{ .Title }}</h1>
  {{ with .Date }}<p class="meta">{{ .Format "2006-01-02" }}</p>{{ end }}
  {{ with .Params.tags }}
    <ul class="tags">
      {{ range . }}<li>{{ . }}</li>{{ end }}
    </ul>
  {{ end }}

  <div class="content">
    {{ .Content }}
  </div>

  <nav class="pagination" aria-label="이전/다음 글" style="margin-top:24px; gap:12px; display:flex; justify-content:space-between;">
    <div>
      {{ with .PrevInSection }}
        <a class="btn" href="{{ .RelPermalink }}" aria-label="이전 글: {{ .Title }}">← {{ .Title }}</a>
      {{ end }}
    </div>
    <div>
      {{ with .NextInSection }}
        <a class="btn" href="{{ .RelPermalink }}" aria-label="다음 글: {{ .Title }}">{{ .Title }} →</a>
      {{ end }}
    </div>
  </nav>
</article>
{{ end }}
