{{ define "main" }}
<section class="section">
  {{ if not .IsHome }}
    <h1>{{ .Title }}</h1>
  {{ end }}
  {{ with .Content }}<div class="content">{{ . }}</div>{{ end }}
  <div class="cards">
    {{ range .Paginator.Pages }}
      <article class="card">
        {{ $thumb := .Params.thumbnail }}
        {{ $needsDynamic := or (not $thumb) (eq $thumb "/images/og-default.svg") }}
        <a href="{{ $.RelPermalink }}">
          {{ if $needsDynamic }}
            {{ $tpl := resources.Get "images/project-thumb-template.svg" | resources.ExecuteAsTemplate (printf "gen/thumbs/%s.svg" (.Title | urlize)) . }}
            <img class="thumb" src="{{ $tpl.RelPermalink }}" alt="{{ .Title }} thumbnail" loading="lazy" decoding="async" width="640" height="360" sizes="(max-width: 700px) 100vw, 640px" />
          {{ else }}
            {{ if $.Site.Params.useWebp }}
              {{ $ext := path.Ext $thumb }}
              {{ $webp := replace $thumb $ext ".webp" }}
              {{ $webpStatic := printf "static%s" $webp }}
              {{ if fileExists $webpStatic }}
                <picture>
                  <source type="image/webp" srcset="{{ $webp | relURL }}" />
                  <img class="thumb" src="{{ $thumb | relURL }}" alt="{{ $.Title }} thumbnail" loading="lazy" decoding="async" width="640" height="360" sizes="(max-width: 700px) 100vw, 640px" />
                </picture>
              {{ else }}
                <img class="thumb" src="{{ $thumb | relURL }}" alt="{{ $.Title }} thumbnail" loading="lazy" decoding="async" width="640" height="360" sizes="(max-width: 700px) 100vw, 640px" />
              {{ end }}
            {{ else }}
              <img class="thumb" src="{{ $thumb | relURL }}" alt="{{ $.Title }} thumbnail" loading="lazy" decoding="async" width="640" height="360" sizes="(max-width: 700px) 100vw, 640px" />
            {{ end }}
          {{ end }}
        </a>
        <h2><a href="{{ .RelPermalink }}">{{ .Title }}</a></h2>
        {{ with .Date }}<p class="meta">{{ .Format "2006-01-02" }}</p>{{ end }}
        {{ with .Params.summary }}<p class="summary-text">{{ . }}</p>{{ else }}{{ if .Summary }}<p class="summary-text">{{ .Summary }}</p>{{ end }}{{ end }}
        {{ with .Params.techTags }}
          <ul class="tags">
            {{ range . }}<li>{{ . }}</li>{{ end }}
          </ul>
        {{ end }}
        <p><a class="btn" href="{{ .RelPermalink }}" aria-label="프로젝트 {{ .Title }} 자세히 보기">자세히 보기</a></p>
      </article>
    {{ end }}
  </div>
  <nav class="pagination">
    {{ template "_internal/pagination.html" . }}
  </nav>
</section>
{{ end }}
