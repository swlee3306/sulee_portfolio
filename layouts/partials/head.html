{{- $title := .Title -}}
{{- if .IsHome -}}{{ $title = .Site.Title }}{{ else }}{{ $title = printf "%s | %s" $title .Site.Title }}{{ end -}}
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>{{ $title }}</title>
<meta name="description" content="{{ with .Params.description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
<link rel="canonical" href="{{ .Permalink }}">

<meta name="theme-color" content="#111111">
<link rel="icon" href="{{ "/favicon.svg" | relURL }}" type="image/svg+xml">
<link rel="apple-touch-icon" href="{{ "/favicon.svg" | relURL }}">

{{ with .Site.Params.author }}<meta name="author" content="{{ . }}">{{ end }}

<!-- Resource Hints: speed up third-party badge loads (GitHub Shields) -->
<link rel="dns-prefetch" href="//img.shields.io">
<link rel="preconnect" href="https://img.shields.io" crossorigin>

{{ with .Params.robots }}<meta name="robots" content="{{ . }}">{{ end }}

{{/* Open Graph / Twitter Cards */}}
{{- $desc := cond (isset .Params "description") .Params.description .Site.Params.description -}}
{{- $image := .Site.Params.ogImage -}}
{{- if .Params.cover -}}
  {{- $image = .Params.cover -}}
{{- else if .Params.thumbnail -}}
  {{- $image = .Params.thumbnail -}}
{{- end -}}
<meta property="og:type" content="{{ if .IsHome }}website{{ else }}article{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:title" content="{{ $title }}">
<meta property="og:description" content="{{ $desc }}">
{{ if $image }}<meta property="og:image" content="{{ $image | absURL }}">{{ end }}

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="{{ $title }}">
<meta name="twitter:description" content="{{ $desc }}">
{{ if $image }}<meta name="twitter:image" content="{{ $image | absURL }}">{{ end }}

<!-- Preload critical CSS then load normally (with cache-busting) -->
{{ $css := (printf "%s?v=%d" (relURL "/css/styles.css") (now.Unix)) }}
<link rel="preload" as="style" href="{{ $css }}">
<link rel="stylesheet" href="{{ $css }}">
{{ with .OutputFormats.Get "RSS" -}}
  <link rel="alternate" type="application/rss+xml" title="RSS" href="{{ .RelPermalink }}">
{{- end }}

{{/* Lightweight JSON-LD: Person */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Person",
  "name": "{{ .Site.Params.author }}",
  "url": "{{ .Site.BaseURL }}",
  "sameAs": [
    {{- range $i, $s := .Site.Params.socials -}}
      {{- if $i }}, {{ end -}}
      "{{ $s.url }}"
    {{- end -}}
  ]
}
</script>

{{ partial "analytics.html" . }}
