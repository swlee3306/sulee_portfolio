<!doctype html><html lang=ko><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>개발부터 프로덕션까지 로깅 전략 | Dev Note by sw'Lee</title><meta name=description content="구조화된 로깅, 로테이션, OpenSearch/ELK를 활용한 중앙화된 수집을 다루는 개발부터 프로덕션까지 확장 가능한 로깅 전략 구축 가이드"><link rel=canonical href=https://swlee3306.github.io/sulee_portfolio/blog/logging-strategy-dev-to-prod/><meta name=theme-color content="#111111"><link rel=icon href=../../favicon.svg type=image/svg+xml><link rel=apple-touch-icon href=../../favicon.svg><meta name=author content="이상욱"><link rel=dns-prefetch href=//img.shields.io><link rel=preconnect href=https://img.shields.io crossorigin><meta property="og:type" content="article"><meta property="og:url" content="https://swlee3306.github.io/sulee_portfolio/blog/logging-strategy-dev-to-prod/"><meta property="og:title" content="개발부터 프로덕션까지 로깅 전략 | Dev Note by sw'Lee"><meta property="og:description" content="구조화된 로깅, 로테이션, OpenSearch/ELK를 활용한 중앙화된 수집을 다루는 개발부터 프로덕션까지 확장 가능한 로깅 전략 구축 가이드"><meta property="og:image" content="https://swlee3306.github.io/images/og-default.svg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="개발부터 프로덕션까지 로깅 전략 | Dev Note by sw'Lee"><meta name=twitter:description content="구조화된 로깅, 로테이션, OpenSearch/ELK를 활용한 중앙화된 수집을 다루는 개발부터 프로덕션까지 확장 가능한 로깅 전략 구축 가이드"><meta name=twitter:image content="https://swlee3306.github.io/images/og-default.svg"><link rel=preload as=style href="../../css/styles.css?v=1758703388"><link rel=stylesheet href="../../css/styles.css?v=1758703388"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Person","name":"이상욱","url":"https:\/\/swlee3306.github.io\/sulee_portfolio\/","sameAs":[]}</script></head><body><a href=#main-content class=skip-link style=position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden>본문으로 건너뛰기</a><header class=site-header><div class="container nav"><a class=brand href=../../>Dev Note by sw'Lee</a><nav><ul><li><a href=../../>Home</a></li><li><a href=../../projects/>Projects</a></li><li><a href=../../blog/>Blog</a></li><li><a href=../../tags/>Tags</a></li><li><a href=../../about/>About</a></li><li><a href=../../contact/>Contact</a></li></ul></nav></div></header><main id=main-content role=main class=container><article class=article><img class=cover src=https://swlee3306.github.io/sulee_portfolio/gen/thumbs/6f427775c717f6c67d268ba0f24ad1e7.svg alt="개발부터 프로덕션까지 로깅 전략 cover" loading=lazy decoding=async width=1200 height=675 sizes="(max-width: 1200px) 100vw, 1200px"><h1>개발부터 프로덕션까지 로깅 전략</h1><p class=meta>2025-01-15</p><ul class=tags><li>logging</li><li>observability</li><li>devops</li><li>go</li><li>opensearch</li><li>elk</li></ul><div class=content><h2 id=tldr>TL;DR</h2><ul><li><strong>목표</strong>: 개발부터 프로덕션까지 확장 가능한 로깅 시스템 구축</li><li><strong>핵심</strong>: 구조화된 로깅, 로테이션 정책, 중앙화된 수집, 성능 최적화</li><li><strong>결과</strong>: 디버깅 효율성 향상, 운영 가시성 확보, 시스템 안정성 증대</li></ul><h2 id=context>Context</h2><p>현대의 분산 시스템에서 로깅은 단순한 디버깅 출력을 넘어서 관찰 가능성의 핵심 구성 요소입니다. 애플리케이션이 개발부터 프로덕션까지 확장되면서, 로깅 전략도 증가하는 볼륨, 복잡성, 운영 요구사항을 처리할 수 있도록 진화해야 합니다.</p><h2 id=problem>Problem</h2><p>대부분의 애플리케이션은 간단한 <code>fmt.Println</code>이나 기본 로깅으로 시작하지만, 이 접근법은 프로덕션에서 문제가 됩니다:</p><ul><li><strong>구조화되지 않은 로그</strong>는 파싱과 검색이 어려움</li><li><strong>일관성 없는 로그 레벨</strong>로 인한 필터링 어려움</li><li><strong>로테이션 전략 부재</strong>로 인한 디스크 공간 문제</li><li><strong>컨텍스트 누락</strong>으로 인한 분산 시스템 디버깅의 어려움</li><li><strong>동기식 로깅</strong>으로 인한 성능 영향</li></ul><h2 id=logging-schema>Logging Schema</h2><h3 id=structured-json-logging>Structured JSON Logging</h3><p>The foundation of scalable logging is structured data. Here&rsquo;s a recommended schema:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;timestamp&#34;</span>: <span style=color:#e6db74>&#34;2025-01-15T10:30:45.123Z&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;level&#34;</span>: <span style=color:#e6db74>&#34;INFO&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;service&#34;</span>: <span style=color:#e6db74>&#34;user-service&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.2.3&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;trace_id&#34;</span>: <span style=color:#e6db74>&#34;abc123-def456&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;span_id&#34;</span>: <span style=color:#e6db74>&#34;def456-ghi789&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;User login successful&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;user_id&#34;</span>: <span style=color:#e6db74>&#34;user_123&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;ip_address&#34;</span>: <span style=color:#e6db74>&#34;192.168.1.100&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;duration_ms&#34;</span>: <span style=color:#ae81ff>45</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;metadata&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;request_id&#34;</span>: <span style=color:#e6db74>&#34;req_789&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;session_id&#34;</span>: <span style=color:#e6db74>&#34;sess_456&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=go-implementation>Go Implementation</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;encoding/json&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>LogEntry</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Timestamp</span> <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`json:&#34;timestamp&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Level</span>     <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`json:&#34;level&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Service</span>   <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`json:&#34;service&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Version</span>   <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`json:&#34;version&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>TraceID</span>   <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`json:&#34;trace_id,omitempty&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>SpanID</span>    <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`json:&#34;span_id,omitempty&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Message</span>   <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`json:&#34;message&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>UserID</span>    <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`json:&#34;user_id,omitempty&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>IPAddress</span> <span style=color:#66d9ef>string</span>                 <span style=color:#e6db74>`json:&#34;ip_address,omitempty&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Duration</span>  <span style=color:#66d9ef>int64</span>                  <span style=color:#e6db74>`json:&#34;duration_ms,omitempty&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Metadata</span>  <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{} <span style=color:#e6db74>`json:&#34;metadata,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Logger</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>service</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>version</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewLogger</span>(<span style=color:#a6e22e>service</span>, <span style=color:#a6e22e>version</span> <span style=color:#66d9ef>string</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Logger</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>service</span>: <span style=color:#a6e22e>service</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>version</span>: <span style=color:#a6e22e>version</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>l</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>Info</span>(<span style=color:#a6e22e>message</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fields</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;INFO&#34;</span>, <span style=color:#a6e22e>message</span>, <span style=color:#a6e22e>fields</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>l</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>Error</span>(<span style=color:#a6e22e>message</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>, <span style=color:#a6e22e>fields</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>fields</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fields</span> = make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{})
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fields</span>[<span style=color:#e6db74>&#34;error&#34;</span>] = <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;ERROR&#34;</span>, <span style=color:#a6e22e>message</span>, <span style=color:#a6e22e>fields</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>l</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>level</span>, <span style=color:#a6e22e>message</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>fields</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entry</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>LogEntry</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Timestamp</span>: <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>UTC</span>().<span style=color:#a6e22e>Format</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>RFC3339Nano</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Level</span>:     <span style=color:#a6e22e>level</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Service</span>:   <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>service</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Version</span>:   <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>version</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Message</span>:   <span style=color:#a6e22e>message</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Metadata</span>:  <span style=color:#a6e22e>fields</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>NewEncoder</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>).<span style=color:#a6e22e>Encode</span>(<span style=color:#a6e22e>entry</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=log-levels-strategy>Log Levels Strategy</h2><h3 id=development-vs-production>Development vs Production</h3><p><strong>Development:</strong></p><ul><li><code>DEBUG</code>: Detailed execution flow</li><li><code>INFO</code>: General application flow</li><li><code>WARN</code>: Potential issues</li><li><code>ERROR</code>: Actual errors</li></ul><p><strong>Production:</strong></p><ul><li><code>INFO</code>: Key business events</li><li><code>WARN</code>: Issues that don&rsquo;t break functionality</li><li><code>ERROR</code>: Errors that need attention</li><li><code>FATAL</code>: System-breaking errors</li></ul><h3 id=level-configuration>Level Configuration</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>LogLevel</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>DEBUG</span> <span style=color:#a6e22e>LogLevel</span> = <span style=color:#66d9ef>iota</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>INFO</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>WARN</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ERROR</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>FATAL</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>l</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>shouldLog</span>(<span style=color:#a6e22e>level</span> <span style=color:#a6e22e>LogLevel</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>envLevel</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Getenv</span>(<span style=color:#e6db74>&#34;LOG_LEVEL&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>envLevel</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;DEBUG&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>level</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>DEBUG</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;INFO&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>level</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>INFO</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;WARN&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>level</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>WARN</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;ERROR&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>level</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>ERROR</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;FATAL&#34;</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>level</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>FATAL</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>level</span> <span style=color:#f92672>&gt;=</span> <span style=color:#a6e22e>INFO</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=log-rotation>Log Rotation</h2><h3 id=file-based-rotation>File-based Rotation</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;path/filepath&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>RotatingLogger</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>filename</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maxSize</span>  <span style=color:#66d9ef>int64</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>maxAge</span>   <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>file</span>     <span style=color:#f92672>*</span><span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>File</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewRotatingLogger</span>(<span style=color:#a6e22e>filename</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>maxSize</span> <span style=color:#66d9ef>int64</span>, <span style=color:#a6e22e>maxAge</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Duration</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>RotatingLogger</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>RotatingLogger</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>filename</span>: <span style=color:#a6e22e>filename</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>maxSize</span>:  <span style=color:#a6e22e>maxSize</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>maxAge</span>:   <span style=color:#a6e22e>maxAge</span>,
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>rl</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RotatingLogger</span>) <span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>p</span> []<span style=color:#66d9ef>byte</span>) (<span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>shouldRotate</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>rotate</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>p</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>rl</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RotatingLogger</span>) <span style=color:#a6e22e>shouldRotate</span>() <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>file</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>stat</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Stat</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>stat</span>.<span style=color:#a6e22e>Size</span>() &gt; <span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>maxSize</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>rl</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>RotatingLogger</span>) <span style=color:#a6e22e>rotate</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>file</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Move current file to timestamped backup</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>timestamp</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>Format</span>(<span style=color:#e6db74>&#34;2006-01-02-15-04-05&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>backupName</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>filename</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>timestamp</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stat</span>(<span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>filename</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Rename</span>(<span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>filename</span>, <span style=color:#a6e22e>backupName</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Create new file</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>file</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>OpenFile</span>(<span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>filename</span>, <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>O_CREATE</span>|<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>O_WRONLY</span>|<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>O_APPEND</span>, <span style=color:#ae81ff>0644</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>rl</span>.<span style=color:#a6e22e>file</span> = <span style=color:#a6e22e>file</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=shipping-to-opensearchelk>Shipping to OpenSearch/ELK</h2><h3 id=filebeat-configuration>Filebeat Configuration</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># filebeat.yml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>filebeat.inputs</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>type</span>: <span style=color:#ae81ff>log</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>/var/log/app/*.log</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>fields</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>service</span>: <span style=color:#ae81ff>user-service</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>: <span style=color:#ae81ff>production</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>fields_under_root</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>json.keys_under_root</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>json.add_error_key</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>output.elasticsearch</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>: [<span style=color:#e6db74>&#34;opensearch:9200&#34;</span>]
</span></span><span style=display:flex><span>  <span style=color:#f92672>index</span>: <span style=color:#e6db74>&#34;logs-%{+yyyy.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>processors</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>add_host_metadata</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>when.not.contains.tags</span>: <span style=color:#ae81ff>forwarded</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>add_cloud_metadata</span>: <span style=color:#ae81ff>~</span>
</span></span></code></pre></div><h3 id=logstash-pipeline>Logstash Pipeline</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#75715e># logstash.conf</span>
</span></span><span style=display:flex><span>input {
</span></span><span style=display:flex><span>  beats {
</span></span><span style=display:flex><span>    port <span style=color:#f92672>=&gt;</span> <span style=color:#ae81ff>5044</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filter {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span>fields<span style=color:#f92672>][</span>service<span style=color:#f92672>]</span> {
</span></span><span style=display:flex><span>    mutate {
</span></span><span style=display:flex><span>      add_field <span style=color:#f92672>=&gt;</span> { <span style=color:#e6db74>&#34;service&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;%{[fields][service]}&#34;</span> }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span>fields<span style=color:#f92672>][</span>environment<span style=color:#f92672>]</span> {
</span></span><span style=display:flex><span>    mutate {
</span></span><span style=display:flex><span>      add_field <span style=color:#f92672>=&gt;</span> { <span style=color:#e6db74>&#34;environment&#34;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;%{[fields][environment]}&#34;</span> }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  date {
</span></span><span style=display:flex><span>    match <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;timestamp&#34;</span>, <span style=color:#e6db74>&#34;ISO8601&#34;</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output {
</span></span><span style=display:flex><span>  opensearch {
</span></span><span style=display:flex><span>    hosts <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;opensearch:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    index <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#34;logs-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=performance-considerations>Performance Considerations</h2><h3 id=asynchronous-logging>Asynchronous Logging</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;sync&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>AsyncLogger</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entries</span> <span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>LogEntry</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>wg</span>      <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>WaitGroup</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>done</span>    <span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewAsyncLogger</span>(<span style=color:#a6e22e>bufferSize</span> <span style=color:#66d9ef>int</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>AsyncLogger</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>al</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>AsyncLogger</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>entries</span>: make(<span style=color:#66d9ef>chan</span> <span style=color:#a6e22e>LogEntry</span>, <span style=color:#a6e22e>bufferSize</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>done</span>:    make(<span style=color:#66d9ef>chan</span> <span style=color:#66d9ef>struct</span>{}),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>worker</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>al</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>al</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>AsyncLogger</span>) <span style=color:#a6e22e>worker</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Done</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>entry</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>entries</span>:
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>writeEntry</span>(<span style=color:#a6e22e>entry</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>done</span>:
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Flush remaining entries</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>entry</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&lt;-</span><span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>entries</span>:
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>writeEntry</span>(<span style=color:#a6e22e>entry</span>)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>al</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>AsyncLogger</span>) <span style=color:#a6e22e>Log</span>(<span style=color:#a6e22e>entry</span> <span style=color:#a6e22e>LogEntry</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>select</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>entries</span> <span style=color:#f92672>&lt;-</span> <span style=color:#a6e22e>entry</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Buffer full, drop log entry</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// In production, consider alerting</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>al</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>AsyncLogger</span>) <span style=color:#a6e22e>writeEntry</span>(<span style=color:#a6e22e>entry</span> <span style=color:#a6e22e>LogEntry</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Implementation for writing log entry</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// This would typically write to file or send to log collector</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>al</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>AsyncLogger</span>) <span style=color:#a6e22e>Close</span>() {
</span></span><span style=display:flex><span>    close(<span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>done</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>al</span>.<span style=color:#a6e22e>wg</span>.<span style=color:#a6e22e>Wait</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=memory-management>Memory Management</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Log entry pooling to reduce GC pressure</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>entryPool</span> = <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>Pool</span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>New</span>: <span style=color:#66d9ef>func</span>() <span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>LogEntry</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Metadata</span>: make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}),
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>l</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>getEntry</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>LogEntry</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entry</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>entryPool</span>.<span style=color:#a6e22e>Get</span>().(<span style=color:#f92672>*</span><span style=color:#a6e22e>LogEntry</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>reset</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>entry</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>l</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>putEntry</span>(<span style=color:#a6e22e>entry</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>LogEntry</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entryPool</span>.<span style=color:#a6e22e>Put</span>(<span style=color:#a6e22e>entry</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>LogEntry</span>) <span style=color:#a6e22e>reset</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Timestamp</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Level</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Service</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Version</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>TraceID</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>SpanID</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Message</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>UserID</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>IPAddress</span> = <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Duration</span> = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Clear metadata map</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Metadata</span> {
</span></span><span style=display:flex><span>        delete(<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>Metadata</span>, <span style=color:#a6e22e>k</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=best-practices>Best Practices</h2><h3 id=1-sensitive-data-masking>1. Sensitive Data Masking</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>maskSensitiveData</span>(<span style=color:#a6e22e>data</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{} {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sensitive</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{<span style=color:#e6db74>&#34;password&#34;</span>, <span style=color:#e6db74>&#34;token&#34;</span>, <span style=color:#e6db74>&#34;secret&#34;</span>, <span style=color:#e6db74>&#34;key&#34;</span>}
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>masked</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{})
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>k</span>, <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>data</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>contains</span>(<span style=color:#a6e22e>sensitive</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>ToLower</span>(<span style=color:#a6e22e>k</span>)) {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>masked</span>[<span style=color:#a6e22e>k</span>] = <span style=color:#e6db74>&#34;***MASKED***&#34;</span>
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>masked</span>[<span style=color:#a6e22e>k</span>] = <span style=color:#a6e22e>v</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>masked</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>contains</span>(<span style=color:#a6e22e>slice</span> []<span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>item</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>slice</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>s</span> <span style=color:#f92672>==</span> <span style=color:#a6e22e>item</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2-context-propagation>2. Context Propagation</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Context</span>) <span style=color:#a6e22e>WithTraceID</span>(<span style=color:#a6e22e>traceID</span> <span style=color:#66d9ef>string</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>Context</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>Context</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>traceID</span>: <span style=color:#a6e22e>traceID</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>spanID</span>:  <span style=color:#a6e22e>generateSpanID</span>(),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>logger</span>:  <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>WithFields</span>(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}{
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;trace_id&#34;</span>: <span style=color:#a6e22e>traceID</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;span_id&#34;</span>:  <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>spanID</span>,
</span></span><span style=display:flex><span>        }),
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-structured-error-logging>3. Structured Error Logging</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>l</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Logger</span>) <span style=color:#a6e22e>LogError</span>(<span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>, <span style=color:#a6e22e>context</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entry</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>getEntry</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>putEntry</span>(<span style=color:#a6e22e>entry</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Level</span> = <span style=color:#e6db74>&#34;ERROR&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Message</span> = <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Metadata</span> = <span style=color:#a6e22e>context</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Metadata</span>[<span style=color:#e6db74>&#34;error_type&#34;</span>] = <span style=color:#a6e22e>reflect</span>.<span style=color:#a6e22e>TypeOf</span>(<span style=color:#a6e22e>err</span>).<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>l</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;ERROR&#34;</span>, <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Message</span>, <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Metadata</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=monitoring-and-alerting>Monitoring and Alerting</h2><h3 id=opensearch-dashboards>OpenSearch Dashboards</h3><p>Create dashboards to monitor:</p><ul><li>Error rates by service</li><li>Response time percentiles</li><li>Log volume trends</li><li>Critical error patterns</li></ul><h3 id=alert-rules>Alert Rules</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># alerting rules</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>HighErrorRate</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>expr</span>: <span style=color:#ae81ff>rate(logs{level=&#34;ERROR&#34;}[5m]) &gt; 0.1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>for</span>: <span style=color:#ae81ff>2m</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>severity</span>: <span style=color:#ae81ff>warning</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>summary</span>: <span style=color:#e6db74>&#34;High error rate detected&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>LogVolumeSpike</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>expr</span>: <span style=color:#ae81ff>rate(logs[5m]) &gt; 1000</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>for</span>: <span style=color:#ae81ff>1m</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>severity</span>: <span style=color:#ae81ff>critical</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>summary</span>: <span style=color:#e6db74>&#34;Log volume spike detected&#34;</span>
</span></span></code></pre></div><h2 id=further-work>Further Work</h2><ul><li><strong>Distributed Tracing</strong>: Integrate with Jaeger or Zipkin</li><li><strong>Metrics Integration</strong>: Combine logs with Prometheus metrics</li><li><strong>AI-powered Analysis</strong>: Implement anomaly detection</li><li><strong>Automated Remediation</strong>: Self-healing based on log patterns</li><li><strong>Compliance</strong>: GDPR/PCI-DSS compliant logging</li></ul><h2 id=conclusion>Conclusion</h2><p>A well-designed logging strategy is essential for maintaining observability in production systems. By implementing structured logging, proper rotation, and centralized collection, you can build a foundation for effective debugging, monitoring, and alerting.</p><p>The key is to start simple and evolve your logging strategy as your system grows, always keeping performance and operational requirements in mind.</p></div><nav class=pagination aria-label="이전/다음 글" style=margin-top:24px;gap:12px;display:flex;justify-content:space-between><div><a class=btn href=../../blog/accessibility-keyboard-navigation-guide/ aria-label="이전 글: 웹 접근성: 키보드 네비게이션 체크리스트">← 웹 접근성: 키보드 네비게이션 체크리스트</a></div><div><a class=btn href=../../blog/dynamic-svg-thumbnails-hugo/ aria-label="다음 글: Hugo 동적 SVG 썸네일">Hugo 동적 SVG 썸네일 →</a></div></nav></article></main><footer class=site-footer><div class=container><p>© 2025 이상욱</p></div></footer></body></html>